<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HCD Admission Rubric Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
      .rubric-cell { transition: all 0.2s ease; cursor: pointer; border: 2px solid transparent; }
      .rubric-cell:hover { transform: translateY(-2px); border-color: #cbd5e1; }
      .rubric-cell.selected { border-color: #ef4444; background-color: #fef2f2; }
      .sticky-verdict { position: sticky; bottom: 2rem; z-index: 50; }
      .item-checkbox:checked + label { color: #b91c1c; font-weight: 600; }
      .tab-active { border-bottom: 2px solid #ef4444; color: #ef4444; }
      
      .collapse-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out, opacity 0.3s ease;
        opacity: 0;
      }
      .collapse-content.open {
        max-height: 1000px;
        opacity: 1;
      }
      .chevron-icon {
        transition: transform 0.3s ease;
      }
      .chevron-icon.open {
        transform: rotate(180deg);
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.469.0"
      }
    }
    </script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="typescript,react">
      import React, { useState, useEffect, useMemo } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        GraduationCap, Briefcase, PenTool, Video, Compass, Target, FolderCode, 
        Save, Trash2, AlertCircle, CheckCircle2, ChevronDown, XCircle, Info, 
        CloudUpload, FileText, CheckSquare, Layers, BookOpen, PenLine, Mail, 
        Folder, Search, Download, ArrowLeft, Eye,
        TrendingUp, AlertTriangle, Skull, Copy, Check, ExternalLink, X, PlusCircle
      } from 'lucide-react';

      const MATERIAL_CONFIG = {
        academic: { icon: GraduationCap, label: 'Academic History', color: 'text-blue-700', bg: 'bg-blue-50' },
        resume: { icon: Briefcase, label: 'Resume', color: 'text-slate-700', bg: 'bg-slate-50' },
        statement: { icon: PenLine, label: 'Personal Statement', color: 'text-purple-700', bg: 'bg-purple-50' },
        references: { icon: Mail, label: 'Reference Letters', color: 'text-amber-700', bg: 'bg-amber-50' },
        video: { icon: Video, label: 'Video Questions', color: 'text-red-700', bg: 'bg-red-50' },
        portfolio: { icon: Folder, label: 'Sample Projects', color: 'text-emerald-700', bg: 'bg-emerald-50' }
      };

      const RUBRIC_DATA = [
        {
          id: 'academic',
          title: '1. Academic Preparation',
          icon: <GraduationCap size={20} />,
          sources: ['academic', 'resume', 'references'],
          isBonus: false,
          diagnosticGroups: [
            {
              id: 'pos',
              title: 'Top Admit Indicators (Score 5)',
              icon: <TrendingUp size={14} className="text-green-600" />,
              items: [
                { text: "Undergraduate GPA of approx. 3.7 equivalent or above", source: 'academic' },
                { text: "If not a 'career changer': A- or better in HCD related classes, particularly in last 2 years of school", source: 'academic' },
                { text: "Other grades are consistently above B+", source: 'academic' },
                { text: "Letters of recommendation speak to competence OR Has 5+ years of experience", source: 'references' }
              ]
            },
            {
              id: 'low',
              title: 'Low Admit Factors (Score 2-3)',
              icon: <AlertTriangle size={14} className="text-yellow-600" />,
              items: [
                { text: "Undergraduate GPA approx. 3.0–3.5 equivalent", source: 'academic' },
                { text: "B+ or better in HCD-related courses (if taken)", source: 'academic' },
                { text: "1–2 lower grades in relevant coursework with reasonable explanation", source: 'academic' },
                { text: "Letters suggest developing readiness with some gaps", source: 'references' }
              ]
            },
            {
              id: 'rej',
              title: 'Reject Indicators (Score 0)',
              icon: <Skull size={14} className="text-red-600" />,
              items: [
                { text: "GPA well below 2.7 with no reasonable explanation", source: 'academic' },
                { text: "Multiple weak under B grades in HCD-related coursework", source: 'academic' }
              ]
            }
          ],
          levels: [
            { score: 5, label: 'Top Admit', desc: 'Max Scholarship. GPA 3.7+. Exceptional Prep.' },
            { score: 4, label: 'Strong Admit', desc: 'Strong candidate meeting most Top criteria.' },
            { score: 3, label: 'Admit', desc: 'Solid candidate meeting standard requirements.' },
            { score: 2, label: 'Low Admit', desc: 'Preparation gaps; GPA 3.0-3.5 or some concern.' },
            { score: 1, label: 'Waitlist', desc: 'Below-average candidate; meets few criteria.' },
            { score: 0, label: 'Reject', desc: 'Meets any ONE major Reject indicator.' }
          ]
        },
        {
          id: 'experience',
          title: '2. Experience/Extracurricular',
          icon: <Briefcase size={20} />,
          sources: ['resume'],
          isBonus: false,
          diagnosticGroups: [
            {
              id: 'pos',
              title: 'Top Admit Indicators (Score 5)',
              icon: <TrendingUp size={14} className="text-green-600" />,
              items: [
                { text: "Two or more relevant professional experiences", source: 'resume' },
                { text: "Regional or national recognition", source: 'resume' },
                { text: "Meaningful extracurricular involvement with positive impact", source: 'resume' }
              ]
            },
            {
              id: 'low',
              title: 'Low Admit Factors (Score 2-3)',
              icon: <AlertTriangle size={14} className="text-yellow-600" />,
              items: [
                { text: "Limited or tangentially related professional experience", source: 'resume' },
                { text: "Shows potential, though depth or relevance is modest", source: 'resume' },
                { text: "Average extracurricular involvement; limited impact", source: 'resume' }
              ]
            }
          ],
          levels: [
            { score: 5, label: 'Top Admit', desc: '2+ relevant roles, national/regional recognition.' },
            { score: 4, label: 'Strong Admit', desc: 'Strong background; high impact involvement.' },
            { score: 3, label: 'Admit', desc: 'Standard relevant background and engagement.' },
            { score: 2, label: 'Low Admit', desc: 'Tangential or modest professional depth.' },
            { score: 1, label: 'Waitlist', desc: 'Meets fewer than 3 criteria.' },
            { score: 0, label: 'Reject', desc: 'No relevant experience or involvement.' }
          ]
        },
        {
          id: 'written',
          title: '3. Written Preparation',
          icon: <PenLine size={20} />,
          sources: ['statement'],
          isBonus: false,
          diagnosticGroups: [
            {
              id: 'pos',
              title: 'Top Admit Indicators (Score 5)',
              icon: <TrendingUp size={14} className="text-green-600" />,
              items: [
                { text: "Clear, insightful response to the prompt", source: 'statement' },
                { text: "No spelling or grammar errors", source: 'statement' },
                { text: "Logical, coherent organization", source: 'statement' },
                { text: "Engaging to read", source: 'statement' }
              ]
            },
            {
              id: 'low',
              title: 'Low Admit Factors (Score 2-3)',
              icon: <AlertTriangle size={14} className="text-yellow-600" />,
              items: [
                { text: "Generally on topic but misses one key element", source: 'statement' },
                { text: "1–3 spelling or grammatical errors", source: 'statement' },
                { text: "Needs improvement for clarity or flow", source: 'statement' }
              ]
            },
            {
              id: 'rej',
              title: 'Reject Indicators (Score 0)',
              icon: <Skull size={14} className="text-red-600" />,
              items: [
                { text: "Essay or video demonstrates poor comprehension or effort", source: 'statement' }
              ]
            }
          ],
          levels: [
            { score: 5, label: 'Top Admit', desc: 'Insightful, engaging, flawless organization.' },
            { score: 4, label: 'Strong Admit', desc: 'Strong submission, good vocabulary.' },
            { score: 3, label: 'Admit', desc: 'Solid and standard logic/organization.' },
            { score: 2, label: 'Low Admit', desc: 'Minor errors; lacks engagement or depth.' },
            { score: 1, label: 'Waitlist', desc: 'Underdeveloped flow or clarity.' },
            { score: 0, label: 'Reject', desc: 'Poor comprehension or effort shown.' }
          ]
        },
        {
          id: 'verbal',
          title: '4. Verbal Communication',
          icon: <Video size={20} />,
          sources: ['video'],
          isBonus: false,
          diagnosticGroups: [
            {
              id: 'pos',
              title: 'Top Admit Indicators (Score 5)',
              icon: <TrendingUp size={14} className="text-green-600" />,
              items: [
                { text: "Thoughtful, coherent response; addresses prompt", source: 'video' },
                { text: "Fluent, natural, unscripted delivery", source: 'video' }
              ]
            },
            {
              id: 'low',
              title: 'Low Admit Factors (Score 2-3)',
              icon: <AlertTriangle size={14} className="text-yellow-600" />,
              items: [
                { text: "Demonstrates understanding but misses some aspects", source: 'video' },
                { text: "Average skills; understandable despite limited polish", source: 'video' }
              ]
            },
            {
              id: 'rej',
              title: 'Reject Indicators (Score 0)',
              icon: <Skull size={14} className="text-red-600" />,
              items: [
                { text: "Verbal response is scripted or incoherent", source: 'video' }
              ]
            }
          ],
          levels: [
            { score: 5, label: 'Top Admit', desc: 'Fluent, natural, unscripted, and thoughtful.' },
            { score: 4, label: 'Strong Admit', desc: 'Strong delivery and coherent response.' },
            { score: 3, label: 'Admit', desc: 'Solid candidate meeting standard expectations.' },
            { score: 2, label: 'Low Admit', desc: 'Understandable but limited polish.' },
            { score: 1, label: 'Waitlist', desc: 'Misses main points or underdeveloped.' },
            { score: 0, label: 'Reject', desc: 'Scripted or incoherent delivery.' }
          ]
        },
        {
          id: 'understanding',
          title: '5. Understanding of Program',
          icon: <Compass size={20} />,
          sources: ['statement', 'video'],
          isBonus: false,
          diagnosticGroups: [
            {
              id: 'pos',
              title: 'Top Admit Indicators (Score 5)',
              icon: <TrendingUp size={14} className="text-green-600" />,
              items: [
                { text: "Demonstrates strong understanding and alignment", source: 'statement' },
                { text: "Clear understanding of the HCD profession", source: 'video' },
                { text: "Demonstrates initiative and motivation", source: 'video' }
              ]
            },
            {
              id: 'low',
              title: 'Low Admit Factors (Score 2-3)',
              icon: <AlertTriangle size={14} className="text-yellow-600" />,
              items: [
                { text: "Average understanding of program and profession", source: 'video' },
                { text: "Some awareness but articulation is vague", source: 'statement' }
              ]
            }
          ],
          levels: [
            { score: 5, label: 'Top Admit', desc: 'Exceptional program alignment and field awareness.' },
            { score: 4, label: 'Strong Admit', desc: 'Strong initiative and motivation shown.' },
            { score: 3, label: 'Admit', desc: 'Standard understanding of HCD and program.' },
            { score: 2, label: 'Low Admit', desc: 'Vague articulation of goals or connections.' },
            { score: 1, label: 'Waitlist', desc: 'Limited program connection established.' },
            { score: 0, label: 'Reject', desc: 'Wrong program or no understanding.' }
          ]
        },
        {
          id: 'future',
          title: '6. Future Goals/Fit',
          icon: <Target size={20} />,
          sources: ['statement', 'video', 'references'],
          isBonus: false,
          diagnosticGroups: [
            {
              id: 'pos',
              title: 'Top Admit Indicators (Score 5)',
              icon: <TrendingUp size={14} className="text-green-600" />,
              items: [
                { text: "Brings unique or diverse perspectives", source: 'video' },
                { text: "Strong letters citing relevant qualities", source: 'references' },
                { text: "Demonstrates strong transferable skills", source: 'resume' }
              ]
            },
            {
              id: 'low',
              title: 'Low Admit Factors (Score 2-3)',
              icon: <AlertTriangle size={14} className="text-yellow-600" />,
              items: [
                { text: "Unique perspective but connection is vague", source: 'video' },
                { text: "Average transferable skills", source: 'resume' }
              ]
            }
          ],
          levels: [
            { score: 5, label: 'Top Admit', desc: 'Unique perspectives, strong skills, great fit.' },
            { score: 4, label: 'Strong Admit', desc: 'Strong transferable skills and letters.' },
            { score: 3, label: 'Admit', desc: 'Standard professional trajectory and fit.' },
            { score: 2, label: 'Low Admit', desc: 'Persistence shown, but relevance is unclear.' },
            { score: 1, label: 'Waitlist', desc: 'Limited explanatory power on fit.' },
            { score: 0, label: 'Reject', desc: 'Incompatible goals or weak letters.' }
          ]
        },
        {
          id: 'portfolio',
          title: '7. Optional Sample Projects [Bonus]',
          icon: <Folder size={20} />,
          sources: ['portfolio'],
          isBonus: true,
          diagnosticGroups: [
            {
              id: 'pos',
              title: 'Bonus Indicators (Score 5)',
              icon: <TrendingUp size={14} className="text-green-600" />,
              items: [
                { text: "Relevant sample projects demonstrating expertise", source: 'portfolio' },
                { text: "Showcases creativity and problem-solving", source: 'portfolio' },
                { text: "Showcases technical ability", source: 'portfolio' }
              ]
            },
            {
              id: 'low',
              title: 'Modest Indicators (Score 2-3)',
              icon: <AlertTriangle size={14} className="text-yellow-600" />,
              items: [
                { text: "Projects have limited depth or relevance", source: 'portfolio' }
              ]
            }
          ],
          levels: [
            { score: 5, label: 'Exceptional', desc: 'Technical mastery and deep creativity.' },
            { score: 4, label: 'Strong', desc: 'Highly relevant and rigorous samples.' },
            { score: 3, label: 'Satisfactory', desc: 'Fulfills requirement with standard depth.' },
            { score: 2, label: 'Limited', desc: 'Limited depth or rigor shown.' },
            { score: 1, label: 'Minimal', desc: 'Basic samples with little relevance.' },
            { score: 0, label: 'N/A', desc: 'No projects submitted (No Penalty).' }
          ]
        }
      ];

      const CollapsibleGroup = ({ group, sectionId, checkedItems, onToggle }) => {
        const [isOpen, setIsOpen] = useState(group.id === 'pos');
        
        const getHighlightColors = () => {
          switch(group.id) {
            case 'pos': return { bg: 'bg-green-50 border-green-200', text: 'text-green-900', check: 'text-green-600 focus:ring-green-500' };
            case 'low': return { bg: 'bg-yellow-50 border-yellow-200', text: 'text-yellow-900', check: 'text-yellow-600 focus:ring-yellow-500' };
            case 'rej': return { bg: 'bg-red-50 border-red-200', text: 'text-red-900', check: 'text-red-600 focus:ring-red-500' };
            default: return { bg: 'bg-gray-50 border-gray-200', text: 'text-gray-900', check: 'text-gray-600 focus:ring-gray-500' };
          }
        };

        const colors = getHighlightColors();

        return (
          <div className="bg-white rounded-2xl border border-gray-200 shadow-sm mb-3 overflow-hidden">
            <button 
              onClick={() => setIsOpen(!isOpen)}
              className="w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors"
            >
              <div className="flex items-center gap-3">
                {group.icon}
                <span className="text-[10px] font-bold text-gray-700 uppercase tracking-widest">{group.title}</span>
              </div>
              <ChevronDown className={`chevron-icon text-gray-400 ${isOpen ? 'open' : ''}`} size={16} />
            </button>
            <div className={`collapse-content ${isOpen ? 'open' : ''}`}>
              <div className="px-4 pb-4 space-y-2">
                {group.items.map((item, iIdx) => {
                  const isChecked = (checkedItems[sectionId] || []).includes(item.text);
                  return (
                    <div 
                      key={iIdx} 
                      className={`flex items-start gap-4 p-3 rounded-xl transition-all cursor-pointer ${isChecked ? colors.bg + ' border' : 'hover:bg-gray-50 border border-transparent'}`} 
                      onClick={() => onToggle(sectionId, item.text)}
                    >
                      <input type="checkbox" className={`item-checkbox mt-1 w-4 h-4 rounded border-gray-300 ${colors.check}`} checked={isChecked} readOnly />
                      <div className="flex flex-col">
                        <span className={`text-sm leading-snug font-medium transition-colors ${isChecked ? colors.text : 'text-gray-700'}`}>{item.text}</span>
                        <span className="text-[10px] font-bold uppercase text-gray-500 mt-1">{MATERIAL_CONFIG[item.source]?.label}</span>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        );
      };

      const App = () => {
        const [view, setView] = useState('FORM');
        const [selectedReview, setSelectedReview] = useState(null);
        const [applicant, setApplicant] = useState({ name: '', id: '', reviewer: '' });
        const [scores, setScores] = useState({});
        const [checkedItems, setCheckedItems] = useState({});
        const [notes, setNotes] = useState({});
        const [isSubmitting, setIsSubmitting] = useState(false);
        const [success, setSuccess] = useState(false);
        const [history, setHistory] = useState([]);
        const [searchTerm, setSearchTerm] = useState('');
        const [copySuccess, setCopySuccess] = useState(false);

        useEffect(() => {
          const stored = JSON.parse(localStorage.getItem('admission_reviews') || '[]');
          setHistory(stored);
        }, [view, success]);

        const totalScore = useMemo(() => {
          return Object.values(scores).reduce((a, b) => a + b, 0);
        }, [scores]);

        const averageScore = useMemo(() => {
          const mandatoryIds = RUBRIC_DATA.filter(s => !s.isBonus).map(s => s.id);
          const mandatorySum = mandatoryIds.reduce((a, id) => a + (scores[id] || 0), 0);
          return (mandatorySum / mandatoryIds.length).toFixed(1);
        }, [scores]);

        const isComplete = useMemo(() => {
          const mandatoryIds = RUBRIC_DATA.filter(s => !s.isBonus).map(s => s.id);
          return mandatoryIds.every(id => scores[id] !== undefined);
        }, [scores]);

        const getDecision = (score, currentScores) => {
          // Rule: Reject only if a MANDATORY section has Score 0. Bonus N/A does not reject.
          const hasMandatoryReject = Object.entries(currentScores).some(([id, s]) => {
            const section = RUBRIC_DATA.find(r => r.id === id);
            return s === 0 && section && !section.isBonus;
          });

          if (hasMandatoryReject) return { text: 'Reject', color: 'text-red-600', bg: 'bg-red-50', full: 'Recommend Reject' };
          
          const maxMandatory = 30; // 6 mandatory sections * 5
          // Decision is based on mandatory thresholds, bonus points are purely additive advantage.
          if (score >= maxMandatory * 0.85) return { text: 'Admit', color: 'text-green-700', bg: 'bg-green-50', full: 'Top Admit' };
          if (score >= maxMandatory * 0.70) return { text: 'Admit', color: 'text-green-700', bg: 'bg-green-50', full: 'Strong Admit' };
          if (score >= maxMandatory * 0.50) return { text: 'Admit', color: 'text-yellow-700', bg: 'bg-yellow-50', full: 'Admit' };
          if (score >= maxMandatory * 0.30) return { text: 'Waitlist', color: 'text-orange-700', bg: 'bg-orange-50', full: 'Waitlist' };
          return { text: 'Reject', color: 'text-red-600', bg: 'bg-red-50', full: 'Reject' };
        };

        const recommendation = useMemo(() => getDecision(totalScore, scores), [totalScore, scores]);

        const toggleItem = (sectionId, itemText) => {
          setCheckedItems(prev => {
            const sectionItems = prev[sectionId] || [];
            if (sectionItems.includes(itemText)) {
              return { ...prev, [sectionId]: sectionItems.filter(i => i !== itemText) };
            } else {
              return { ...prev, [sectionId]: [...sectionItems, itemText] };
            }
          });
        };

        const handleScoreToggle = (sectionId, score) => {
          setScores(prev => {
            const next = { ...prev };
            if (next[sectionId] === score) {
              delete next[sectionId];
            } else {
              next[sectionId] = score;
            }
            return next;
          });
        };

        const handleSubmit = async () => {
          if (!applicant.name) return alert('Please enter applicant name.');
          setIsSubmitting(true);
          const submission = { ...applicant, scores, checkedItems, notes, totalScore, averageScore, recommendation: recommendation.full, decisionType: recommendation.text, timestamp: new Date().toISOString() };
          const localHistory = JSON.parse(localStorage.getItem('admission_reviews') || '[]');
          localHistory.push(submission);
          localStorage.setItem('admission_reviews', JSON.stringify(localHistory));
          setIsSubmitting(false);
          setSuccess(true);
        };

        const generateCSV = (format = 'csv') => {
          const sep = format === 'tsv' ? '\t' : ',';
          const headers = ['Applicant', 'ID', 'Reviewer', 'Mandatory Average', 'Final Weighted Score', 'Decision', 'Timestamp'];
          const rows = history.map(h => [
            h.name, h.id, h.reviewer, h.averageScore, h.totalScore, h.recommendation, new Date(h.timestamp).toLocaleString()
          ].map(field => `"${String(field).replace(/"/g, '""')}"`).join(sep));
          return [headers.join(sep), ...rows].join('\n');
        };

        const handleCopy = () => {
          const tsv = generateCSV('tsv');
          navigator.clipboard.writeText(tsv).then(() => {
            setCopySuccess(true);
            setTimeout(() => setCopySuccess(false), 3000);
          });
        };

        const handleDownload = () => {
          const csv = generateCSV('csv');
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `HCD_Admissions_Review_${new Date().toISOString().split('T')[0]}.csv`;
          link.click();
        };

        if (success) {
          return (
            <div className="min-h-screen flex items-center justify-center p-4">
              <div className="max-w-md w-full bg-white rounded-3xl shadow-xl p-10 text-center border border-gray-100">
                <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6"><CheckCircle2 size={40} /></div>
                <h2 className="text-2xl font-bold text-gray-900 mb-2">Review Recorded</h2>
                <div className="space-y-3 mt-8">
                  <button onClick={() => window.location.reload()} className="w-full py-4 bg-red-600 text-white rounded-2xl font-bold hover:bg-red-700 shadow-lg transition-transform active:scale-95">New Review</button>
                  <button onClick={() => { setSuccess(false); setView('HISTORY'); }} className="w-full py-4 bg-gray-100 text-gray-700 rounded-2xl font-bold hover:bg-gray-200 transition-transform active:scale-95">View Archive</button>
                </div>
              </div>
            </div>
          );
        }

        return (
          <div className="max-w-6xl mx-auto px-4 py-12">
            <header className="mb-12 flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-gray-200 pb-6">
              <div>
                <h1 className="text-3xl font-bold text-gray-900 tracking-tight">HCD Admission Hub</h1>
                <p className="text-gray-700 mt-2 font-normal uppercase tracking-widest text-sm">Master of Science in Human Centered Design</p>
              </div>
              <nav className="flex items-center gap-8 text-sm font-normal uppercase tracking-widest text-gray-700">
                <button onClick={() => setView('FORM')} className={`pb-2 transition-all ${view === 'FORM' ? 'tab-active' : 'hover:text-gray-900'}`}>New Form</button>
                <button onClick={() => setView('HISTORY')} className={`pb-2 transition-all ${view === 'HISTORY' ? 'tab-active' : 'hover:text-gray-900'}`}>Review Archive</button>
              </nav>
            </header>

            {view === 'FORM' ? (
              <>
                <section className="bg-white rounded-3xl shadow-sm border border-gray-200 p-8 mb-16">
                  <div className="flex items-center gap-3 mb-8">
                    <FileText className="text-red-600" size={20} />
                    <h2 className="text-sm font-bold text-gray-800 uppercase tracking-widest">Applicant Identity</h2>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div>
                      <label className="block text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-2">Name</label>
                      <input type="text" placeholder="e.g. Alex Rivera" className="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-red-500 focus:outline-none font-medium" value={applicant.name} onChange={(e) => setApplicant({...applicant, name: e.target.value})} />
                    </div>
                    <div>
                      <label className="block text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-2">Application ID</label>
                      <input type="text" placeholder="BU-0000" className="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-red-500 focus:outline-none font-medium" value={applicant.id} onChange={(e) => setApplicant({...applicant, id: e.target.value})} />
                    </div>
                    <div>
                      <label className="block text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-2">Reviewer</label>
                      <input type="text" placeholder="Admin Smith" className="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-red-500 focus:outline-none font-medium" value={applicant.reviewer} onChange={(e) => setApplicant({...applicant, reviewer: e.target.value})} />
                    </div>
                  </div>
                </section>

                <div className="space-y-32">
                  {RUBRIC_DATA.map((section) => (
                    <div key={section.id} className="relative">
                      <div className="flex flex-col lg:flex-row lg:items-center justify-between gap-6 mb-10 pb-6 border-b border-gray-100">
                        <div className="flex items-center gap-4">
                          <span className="p-2 bg-slate-900 text-white rounded-xl shadow-lg">{section.icon}</span>
                          <h3 className="text-2xl font-bold text-gray-900 tracking-tight">{section.title} {section.isBonus && <span className="text-sm font-normal text-emerald-600">(Bonus Section)</span>}</h3>
                        </div>
                        <div className="flex flex-wrap gap-2">
                           {section.sources.map(s => {
                             const config = MATERIAL_CONFIG[s];
                             return (
                               <span key={s} className="px-3 py-1.5 bg-white border border-gray-200 rounded-xl text-[10px] font-bold text-gray-600 flex items-center gap-2 shadow-sm uppercase tracking-widest">
                                 <config.icon size={12} className={config.color} /> {config.label.split(' ')[0]}
                               </span>
                             );
                           })}
                        </div>
                      </div>

                      <div className="grid grid-cols-1 lg:grid-cols-12 gap-12">
                        <div className="lg:col-span-5">
                           <p className="text-[10px] font-bold text-gray-600 uppercase tracking-widest px-2 mb-4">Evidence Checklist</p>
                           {section.diagnosticGroups.map((group) => (
                             <CollapsibleGroup 
                               key={group.id}
                               group={group}
                               sectionId={section.id}
                               checkedItems={checkedItems}
                               onToggle={toggleItem}
                             />
                           ))}
                        </div>

                        <div className="lg:col-span-7 space-y-6">
                           <p className="text-[10px] font-bold text-gray-600 uppercase tracking-widest px-2 mb-2">Evaluated Tier Verdict</p>
                           <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              {section.levels.map((level) => {
                                const isSelected = scores[section.id] === level.score;
                                const getScoreHighlight = () => {
                                  // Rule: Score 0 in a BONUS section is NEUTRAL (Gray).
                                  if (level.score === 0 && section.isBonus) return { border: 'border-slate-300', bg: 'bg-slate-50', badge: 'bg-slate-200 text-slate-700' };
                                  
                                  if (level.score >= 4) return { border: 'border-green-600', bg: 'bg-green-50', badge: 'bg-green-100 text-green-800' };
                                  if (level.score === 2 || level.score === 3) return { border: 'border-yellow-600', bg: 'bg-yellow-50', badge: 'bg-yellow-100 text-yellow-800' };
                                  if (level.score === 1) return { border: 'border-orange-600', bg: 'bg-orange-50', badge: 'bg-orange-100 text-orange-800' };
                                  return { border: 'border-red-600', bg: 'bg-red-50', badge: 'bg-red-100 text-red-800' };
                                };
                                const highlights = getScoreHighlight();
                                
                                return (
                                  <div key={level.score} onClick={() => handleScoreToggle(section.id, level.score)} className={`rubric-cell p-5 rounded-2xl flex flex-col border-2 transition-all ${isSelected ? highlights.border + ' ' + highlights.bg : 'bg-white border-gray-100'}`}>
                                    <div className="flex items-center justify-between mb-4">
                                      <span className={`text-[10px] font-bold px-2 py-1 rounded-lg uppercase tracking-widest ${highlights.badge}`}>Score: {level.score}</span>
                                      {isSelected && <CheckCircle2 size={16} className={highlights.border.replace('border', 'text')} />}
                                    </div>
                                    <p className="font-bold text-gray-900 tracking-tight leading-tight mb-2 uppercase text-xs">{level.label}</p>
                                    <p className="text-[11px] text-gray-700 leading-relaxed font-medium">{level.desc}</p>
                                  </div>
                                );
                              })}
                           </div>
                           <textarea placeholder="Observation summary or context..." className="w-full p-6 bg-white border border-gray-200 rounded-3xl focus:outline-none focus:ring-2 focus:ring-red-500 text-sm italic font-medium shadow-sm" rows={3} value={notes[section.id] || ''} onChange={(e) => setNotes({...notes, [section.id]: e.target.value})} />
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="sticky-verdict mt-32">
                  <div className={`transition-all duration-500 rounded-[2rem] shadow-2xl border-4 flex flex-col lg:flex-row items-center justify-between transition-all ${isComplete ? recommendation.bg : 'bg-white'} ${isComplete ? recommendation.color.replace('text', 'border') : 'border-gray-200'} ${isComplete ? 'p-8 gap-10' : 'p-4 gap-6 opacity-90 backdrop-blur-sm'}`}>
                    <div className="flex items-center gap-6 lg:gap-10">
                      <div className="text-center lg:text-left">
                        <p className={`font-bold text-gray-600 uppercase tracking-widest mb-1 ${isComplete ? 'text-[10px]' : 'text-[8px]'}`}>Mandatory Avg</p>
                        <p className={`font-bold text-gray-900 leading-none transition-all ${isComplete ? 'text-4xl' : 'text-xl'}`}>{averageScore}</p>
                      </div>
                      <div className="h-12 w-px bg-gray-300 hidden lg:block" />
                      <div className="text-center lg:text-left">
                        <p className={`font-bold text-gray-600 uppercase tracking-widest mb-1 ${isComplete ? 'text-[10px]' : 'text-[8px]'}`}>Weighted Final</p>
                        <p className={`font-bold text-gray-900 leading-none transition-all ${isComplete ? 'text-4xl' : 'text-xl'}`}>{totalScore}</p>
                      </div>
                      <div className="h-12 w-px bg-gray-300 hidden lg:block" />
                      <div>
                        <p className={`font-bold text-gray-600 uppercase tracking-widest mb-1 ${isComplete ? 'text-[10px]' : 'text-[8px]'}`}>Verdict Recommendation</p>
                        <p className={`font-bold tracking-tight leading-none transition-all ${isComplete ? recommendation.color : 'text-gray-400'} ${isComplete ? 'text-4xl' : 'text-xl'}`}>
                          {isComplete ? recommendation.full : 'Form Incomplete'}
                        </p>
                      </div>
                    </div>
                    <div className="flex items-center gap-4 w-full lg:w-auto">
                       <button onClick={() => confirm('Reset current form?') && window.location.reload()} className={`bg-white text-gray-500 hover:text-red-600 rounded-2xl border border-gray-200 shadow-sm transition-all active:scale-95 ${isComplete ? 'p-5' : 'p-3'}`}><Trash2 size={isComplete ? 24 : 18} /></button>
                       <button onClick={handleSubmit} disabled={isSubmitting || !applicant.name} className={`flex-grow lg:flex-grow-0 bg-slate-900 text-white rounded-3xl font-bold hover:bg-black shadow-xl disabled:bg-gray-300 transition-all flex items-center justify-center gap-2 active:scale-95 ${isComplete ? 'px-12 py-5 text-lg' : 'px-8 py-3 text-sm'}`}>
                         {isSubmitting ? 'Recording...' : <><Save size={isComplete ? 20 : 16} /> Record Review</>}
                       </button>
                    </div>
                  </div>
                </div>
              </>
            ) : (
              /* Archive View */
              <div className="space-y-12 animate-in fade-in duration-500">
                <section className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                  <div className="bg-white p-8 rounded-3xl border border-gray-200 shadow-sm text-center">
                    <p className="text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-2">Total Reviewed</p>
                    <p className="text-4xl font-bold text-gray-900">{history.length}</p>
                  </div>
                  <div className="bg-green-50 p-8 rounded-3xl border border-green-100 text-center shadow-sm">
                    <p className="text-[10px] font-bold text-green-700 uppercase tracking-widest mb-2">Admits</p>
                    <p className="text-4xl font-bold text-green-900">{history.filter(h => h.decisionType === 'Admit').length}</p>
                  </div>
                  <div className="bg-orange-50 p-8 rounded-3xl border border-orange-100 text-center shadow-sm text-orange-700">
                    <p className="text-[10px] font-bold uppercase tracking-widest mb-2">Waitlists</p>
                    <p className="text-4xl font-bold text-gray-900">{history.filter(h => h.decisionType === 'Waitlist').length}</p>
                  </div>
                  <div className="bg-red-50 p-8 rounded-3xl border border-red-100 text-center shadow-sm">
                    <p className="text-[10px] font-bold text-red-700 uppercase tracking-widest mb-2">Rejects</p>
                    <p className="text-4xl font-bold text-red-900">{history.filter(h => h.decisionType === 'Reject').length}</p>
                  </div>
                </section>

                <section className="bg-white rounded-[2rem] shadow-sm border border-gray-200 overflow-hidden">
                  <div className="p-8 border-b border-gray-100 flex flex-col md:flex-row justify-between items-center gap-6">
                    <div className="relative w-full max-sm mb-4 md:mb-0">
                      <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500" size={18} />
                      <input type="text" placeholder="Search archive..." className="w-full pl-12 pr-6 py-3 bg-gray-50 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500 text-sm font-medium" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                    </div>
                    <div className="flex gap-3">
                       <button onClick={handleCopy} className="flex items-center gap-2 px-6 py-3 bg-slate-100 text-slate-700 rounded-2xl font-bold text-xs hover:bg-slate-200 transition-all">
                         {copySuccess ? <Check size={14}/> : <Copy size={14}/>} {copySuccess ? 'Copied' : 'Copy for Sheet'}
                       </button>
                       <button onClick={handleDownload} className="flex items-center gap-2 px-6 py-3 bg-slate-900 text-white rounded-2xl font-bold text-xs hover:bg-black transition-all">
                         <Download size={14}/> Export CSV
                       </button>
                    </div>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full text-left">
                      <thead>
                        <tr className="bg-gray-50 text-[10px] font-bold uppercase tracking-widest text-gray-600">
                          <th className="px-8 py-6">Applicant Profile</th>
                          <th className="px-8 py-6">Status Verdict</th>
                          <th className="px-8 py-6 text-center">Avg</th>
                          <th className="px-8 py-6 text-center">Final</th>
                          <th className="px-8 py-6">Reviewer</th>
                          <th className="px-8 py-6 text-right">Action</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-gray-100">
                        {history.filter(h => h.name.toLowerCase().includes(searchTerm.toLowerCase())).map((review, i) => {
                          const decision = getDecision(review.totalScore, review.scores);
                          return (
                            <tr key={i} className="hover:bg-gray-50 transition-all group cursor-pointer" onClick={() => setSelectedReview(review)}>
                              <td className="px-8 py-6">
                                <p className="font-bold text-gray-900 text-base mb-1">{review.name}</p>
                                <p className="text-[10px] font-bold text-gray-600 uppercase tracking-tight">ID: {review.id}</p>
                              </td>
                              <td className="px-8 py-6">
                                <span className={`px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest border ${decision.bg} ${decision.color} border-current`}>
                                  {review.recommendation}
                                </span>
                              </td>
                              <td className="px-8 py-6 text-center font-bold text-gray-900 text-lg">{review.averageScore}</td>
                              <td className="px-8 py-6 text-center font-bold text-gray-900 text-lg">{review.totalScore}</td>
                              <td className="px-8 py-6 text-[11px] font-bold text-gray-600 uppercase tracking-widest">{review.reviewer}</td>
                              <td className="px-8 py-6 text-right">
                                <button className="p-3 text-gray-500 hover:text-red-600 transition-colors"><Eye size={24} /></button>
                              </td>
                            </tr>
                          );
                        })}
                        {history.length === 0 && (
                          <tr><td colSpan="6" className="px-8 py-16 text-center text-gray-500 italic font-medium">No recorded evaluations found.</td></tr>
                        )}
                      </tbody>
                    </table>
                  </div>
                </section>
              </div>
            )}

            {selectedReview && (
              <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
                <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm" onClick={() => setSelectedReview(null)} />
                <div className="relative bg-white w-full max-w-4xl max-h-[90vh] rounded-[3rem] shadow-2xl border border-gray-100 overflow-y-auto animate-in slide-in-from-bottom-8 duration-500">
                  <div className="sticky top-0 bg-white/95 backdrop-blur-md px-10 py-8 flex items-center justify-between border-b border-gray-100 z-10">
                    <div>
                      <h2 className="text-3xl font-bold text-gray-900 tracking-tight">{selectedReview.name}</h2>
                      <p className="text-[10px] font-bold text-gray-600 uppercase tracking-widest">Diagnostic Report • Reviewed by {selectedReview.reviewer}</p>
                    </div>
                    <button onClick={() => setSelectedReview(null)} className="p-3 bg-gray-100 text-gray-500 hover:text-red-600 rounded-full transition-all"><X size={24} /></button>
                  </div>

                  <div className="p-12 space-y-16">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                       <div className={`p-10 rounded-3xl text-center border-4 ${getDecision(selectedReview.totalScore, selectedReview.scores).bg} ${getDecision(selectedReview.totalScore, selectedReview.scores).color.replace('text', 'border')}`}>
                         <p className="text-xs font-bold uppercase tracking-widest mb-2 opacity-60 text-gray-800">Final Verdict</p>
                         <p className="text-6xl font-bold tracking-tighter leading-none mb-3 text-gray-900">{selectedReview.totalScore}</p>
                         <p className="text-xl font-bold tracking-tight text-gray-900">{selectedReview.recommendation}</p>
                         <p className="text-xs font-medium text-gray-500 mt-2">Mandatory Base Avg: {selectedReview.averageScore}</p>
                      </div>
                      <div className="bg-gray-50 rounded-3xl p-10 flex flex-col justify-center space-y-4">
                        <div className="flex justify-between border-b border-gray-200 pb-2">
                          <span className="text-[10px] font-bold text-gray-600 uppercase">Reviewer</span>
                          <span className="text-xs font-bold text-gray-900">{selectedReview.reviewer}</span>
                        </div>
                        <div className="flex justify-between border-b border-gray-200 pb-2">
                          <span className="text-[10px] font-bold text-gray-600 uppercase">Submission ID</span>
                          <span className="text-xs font-bold text-gray-900">{selectedReview.id}</span>
                        </div>
                        <div className="flex justify-between border-b border-gray-200 pb-2">
                          <span className="text-[10px] font-bold text-gray-600 uppercase">Timestamp</span>
                          <span className="text-xs font-bold text-gray-900">{new Date(selectedReview.timestamp).toLocaleString()}</span>
                        </div>
                      </div>
                    </div>

                    <div className="space-y-16">
                      {RUBRIC_DATA.map(section => (
                        <div key={section.id}>
                          <div className="flex items-center justify-between mb-8 border-l-4 border-slate-900 pl-4">
                            <h4 className="text-xl font-bold text-gray-900">
                               {section.title} {section.isBonus && <span className="text-sm font-normal text-emerald-600">(Bonus)</span>}
                            </h4>
                            <span className="text-xs font-bold bg-slate-900 text-white px-4 py-2 rounded-xl">Score: {selectedReview.scores[section.id] ?? 'N/A'}</span>
                          </div>
                          <div className="bg-gray-50 rounded-3xl p-8 border border-gray-100 shadow-inner">
                            <p className="text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-6">Confirmed Evidence</p>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                              {section.diagnosticGroups.flatMap(g => g.items).map((item, idx) => {
                                const isChecked = (selectedReview.checkedItems[section.id] || []).includes(item.text);
                                if (!isChecked) return null;
                                
                                const getChecklistHighlight = () => {
                                  const group = section.diagnosticGroups.find(dg => dg.items.some(i => i.text === item.text));
                                  if (!group) return 'bg-white border-gray-100 text-gray-900';
                                  switch(group.id) {
                                    case 'pos': return 'bg-green-50 border-green-200 text-green-900';
                                    case 'low': return 'bg-yellow-50 border-yellow-200 text-yellow-900';
                                    case 'rej': return 'bg-red-50 border-red-200 text-red-900';
                                    default: return 'bg-white border-gray-100 text-gray-900';
                                  }
                                };
                                const highlights = getChecklistHighlight();

                                return (
                                  <div key={idx} className={`flex items-center gap-4 text-xs p-4 rounded-xl border shadow-sm ${highlights}`}>
                                    <CheckCircle2 size={18} className="flex-shrink-0" />
                                    <span className="font-bold leading-tight">{item.text}</span>
                                  </div>
                                );
                              })}
                              {(selectedReview.checkedItems[section.id] || []).length === 0 && (
                                <p className="text-xs text-gray-500 italic">No specific indicators selected.</p>
                              )}
                            </div>
                            {selectedReview.notes[section.id] && (
                              <div className="pt-6 border-t border-gray-200">
                                <p className="text-[9px] font-bold text-gray-600 uppercase tracking-widest mb-2">Reviewer Commentary</p>
                                <p className="text-sm italic text-gray-700 leading-relaxed font-semibold">"{selectedReview.notes[section.id]}"</p>
                              </div>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}
            
            <footer className="mt-32 text-center text-[9px] font-bold uppercase tracking-[0.3em] text-gray-500 pb-12 border-t border-gray-100 pt-16">
            </footer>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
